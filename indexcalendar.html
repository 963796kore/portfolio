<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Festivals & Promotions â€” Single Page Project</title>

</head>
<style>
    :root{
  --accent:#6a8bff;
  --accent-2:#ff9a66;
  --muted:#7b8aa3;
  --card-bg: rgba(255,255,255,0.9);
  --glass: rgba(255,255,255,0.12);
  --radius:14px;
  --shadow: 0 8px 30px rgba(18,25,45,0.08);
  --maxW:1100px;
}

/* Reset + base */
*{box-sizing:border-box}
html,body{height:100%}
body{
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  margin:0;
  color:#0b1320;
  background: linear-gradient(180deg,#f3f6ff,#fff);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* Header */
.site-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:14px 18px;
  background:linear-gradient(90deg,var(--accent),#4fb6ff);
  color:white;
  box-shadow:var(--shadow);
  position:sticky;
  top:0;
  z-index:40;
}
.brand{font-weight:700}
.nav{display:flex;gap:8px}
.nav-btn{
  background:rgba(255,255,255,0.12);
  border:0;color:white;padding:8px 12px;border-radius:10px;cursor:pointer;backdrop-filter:blur(2px);
}
.nav-btn:hover{transform:translateY(-3px)}
.auth-area{display:flex;align-items:center;gap:8px}
.auth-area #displayUser{opacity:.95}
.small{padding:6px 10px;border-radius:8px;font-size:13px;cursor:pointer}
.primary{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:10px;cursor:pointer}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.18);color:white}
.muted{color:var(--muted)}
.hidden{display:none}

/* Main sections */
.main{flex:1}
.section{
  min-height:70vh;
  padding:40px 18px;
  display:none;
  transition:opacity .4s ease,transform .4s ease;
}
.section.active{display:block;opacity:1;transform:none}
.inner{max-width:var(--maxW);margin:0 auto}
.narrow{max-width:960px}

/* Section backgrounds */
.section-home{
  background: linear-gradient(135deg,#fff7f3 0%, #fff 100%), url('') no-repeat center/cover;
  display:flex;align-items:center;justify-content:center;text-align:center;
}
.section-home .lead{color:#334155;margin-top:10px}
.home-actions{margin-top:18px;display:flex;gap:12px;justify-content:center}
.cta{padding:12px 18px;border-radius:10px;border:0;cursor:pointer}
.cta.ghost{background:transparent;border:1px solid #dfe6fb}

/* Calendar bg - warm festival */
.section-calendar{
  background: linear-gradient(180deg,#fff6ec,#fff9f3);
  background-attachment:fixed;
}

/* Promo bg - dark contrasting */
.section-promo{
  background: linear-gradient(180deg,#f0f8ff,#eef7ff);
}

/* Contact bg - greenish */
.section-contact{
  background: linear-gradient(180deg,#f7fff6,#f1fff0);
}

/* Dashboard bg - subtle */
.section-dashboard{
  background: linear-gradient(180deg,#f7f9ff,#eef3ff);
}

/* Grid / calendar */
.top-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.weekhead{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;color:var(--muted);font-weight:700;padding:4px;opacity:.9}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:8px}
.cal-cell{
  min-height:80px;background:var(--card-bg);border-radius:10px;padding:8px;position:relative;cursor:pointer;
  box-shadow:0 6px 18px rgba(15,23,42,0.05);border:1px solid rgba(10,20,40,0.03);
}
.cal-cell.inactive{visibility:hidden;opacity:0}
.cal-cell .dateNum{font-weight:800}
.cal-cell .dot{width:8px;height:8px;background:#ff4d6d;border-radius:50%;position:absolute;right:10px;top:10px}
.cal-cell .badge{display:block;margin-top:8px;font-size:12px;padding:6px;border-radius:999px;background:#fff3cd;color:#7a4e00}

/* forms, cards */
.card{background:var(--card-bg);border-radius:12px;padding:14px;box-shadow:var(--shadow);border:1px solid rgba(12,20,40,0.03)}
.form-card input, .form-card textarea, input, textarea{
  width:100%;padding:10px;border-radius:8px;border:1px solid #e6eefb;margin:8px 0;background:transparent;
}
.form-card .row{display:flex;gap:10px}
.form-card .row input{flex:1}
.form-card textarea{min-height:90px;resize:vertical}

/* promos cards */
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px}
.promo-card{border-radius:12px;padding:12px;color:white;position:relative;overflow:hidden;min-height:120px}
.prom-title{font-weight:800;font-size:16px}
.prom-meta{font-size:13px;opacity:.9;margin-top:8px}
.prom-actions{display:flex;gap:8px;margin-top:10px}
.promo-code{background:rgba(255,255,255,0.12);padding:6px 10px;border-radius:8px;margin-top:10px;display:inline-block}

/* database / lists */
.list{list-style:none;padding:0;margin:8px 0}
.list li{padding:8px;border-radius:8px;background:rgba(255,255,255,0.85);margin:6px 0;border:1px solid rgba(12,20,40,0.03)}

/* dashboard */
.db-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:12px}
.db-card{background:linear-gradient(180deg,#fff,#f8fafc);border-radius:12px;padding:14px;box-shadow:var(--shadow);text-align:center}
.db-title{font-size:13px;color:var(--muted)}
.db-value{font-size:22px;font-weight:800;margin-top:6px}

/* misc */
.monthLabel{font-weight:700;padding:6px 10px;border-radius:8px;background:rgba(255,255,255,0.7)}
.cal-bottom{display:flex;gap:18px;margin-top:12px;flex-wrap:wrap}
.mini-form{display:flex;gap:8px;align-items:center}
.mini-form input{padding:8px;border-radius:8px}
.small{font-size:13px;padding:8px;border-radius:8px}
.close-x{position:absolute;right:12px;top:10px;border:0;background:transparent;font-size:18px;cursor:pointer}
.auth-card{width:320px;position:relative;text-align:center}

/* overlay */
.overlay{position:fixed;inset:0;background:rgba(6,10,25,0.45);display:flex;align-items:center;justify-content:center;z-index:60}
.overlay.hidden{display:none}

/* responsive */
@media (max-width:900px){
  .nav{display:none}
  .site-header{padding:12px}
  .auth-area #displayUser{display:none}
  .form-card .row{flex-direction:column}
  .weekhead{display:none}
  .cal-grid{grid-template-columns:repeat(2,1fr)}
  .db-cards{grid-template-columns:1fr}
}

</style>
<body>
  <!-- HEADER / NAV -->
  <header class="site-header">
    <div class="brand">ðŸŽŠ MyFest & Promo</div>
    <nav class="nav">
      <button data-target="home" class="nav-btn">Home</button>
      <button data-target="calendar" class="nav-btn">Calendar</button>
      <button data-target="promotion" class="nav-btn">Promotions</button>
      <button data-target="contact" class="nav-btn">Contact</button>
      <button data-target="dashboard" class="nav-btn">Dashboard</button>
    </nav>
    <div class="auth-area">
      <span id="displayUser">Guest</span>
      <button id="openAuth" class="small">Login</button>
    </div>
  </header>

  <!-- AUTH POPUP -->
  <div id="authOverlay" class="overlay hidden">
    <div class="card auth-card">
      <button class="close-x" id="closeAuth">âœ•</button>
      <h2 id="authTitle">Login</h2>
      <input id="authUser" placeholder="Username" autocomplete="username" />
      <input id="authPass" type="password" placeholder="Password" autocomplete="current-password"/>
      <div class="auth-row">
        <button id="authAction" class="primary">Login</button>
        <button id="authToggle" class="ghost">Sign Up</button>
      </div>
      <div class="auth-row">
        <button id="skipAuth" class="muted">Continue as Guest</button>
      </div>
      <small class="muted">Credentials saved only in browser (localStorage) for demo.</small>
    </div>
  </div>

  <!-- MAIN CONTENT (sections with different backgrounds) -->
  <main class="main">
    <!-- HOME -->
    <section id="home" class="section section-home active">
      <div class="inner">
        <h1>Welcome to MyFest & Promo</h1>
        <p class="lead">Single-file project: Festival calendar, Business promotions, Contact form and Dashboard â€” all in one.</p>
        <div class="home-actions">
          <button class="cta" data-target="calendar">Open Calendar</button>
          <button class="cta ghost" data-target="promotion">Promotions</button>
        </div>
      </div>
    </section>

    <!-- CALENDAR (separate bg) -->
    <section id="calendar" class="section section-calendar">
      <div class="inner narrow">
        <div class="top-row">
          <h2>Festival Calendar</h2>
          <div class="cal-controls">
            <button id="calPrev" class="small">â—€</button>
            <div id="monthYear" class="monthLabel">Month Year</div>
            <button id="calNext" class="small">â–¶</button>
          </div>
        </div>

        <div class="weekhead">
          <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
        </div>
        <div id="calGrid" class="cal-grid"></div>

        <div class="cal-bottom">
          <form id="addFestForm" class="mini-form">
            <input id="festName" type="text" placeholder="Festival name (e.g. Diwali)" required/>
            <input id="festDate" type="date" required />
            <button class="small primary">Add</button>
          </form>
          <div class="selected-info">
            <h3 id="selDate">Selected: â€”</h3>
            <ul id="selFestivals" class="list"></ul>
          </div>
        </div>
      </div>
    </section>

    <!-- PROMOTIONS -->
    <section id="promotion" class="section section-promo">
      <div class="inner narrow">
        <div class="top-row">
          <h2>Business Promotions</h2>
          <div>
            <button id="genCoupon" class="small">Generate Code</button>
            <button id="exportPromo" class="small ghost">Export CSV</button>
          </div>
        </div>

        <form id="promoForm" class="card form-card">
          <input id="promoTitle" placeholder="Title (e.g. Diwali Sale)" required/>
          <div class="row">
            <input id="promoStart" type="date" required/>
            <input id="promoEnd" type="date" required/>
          </div>
          <div class="row">
            <input id="promoOff" type="number" min="0" max="95" placeholder="Discount %"/>
            <input id="promoCode" placeholder="Coupon code (or auto-gen)" />
          </div>
          <textarea id="promoDesc" placeholder="Short description (optional)"></textarea>
          <div class="row">
            <button type="submit" class="primary">Save Promotion</button>
            <button type="button" id="clearPromo" class="ghost">Clear</button>
          </div>
        </form>

        <div id="promoList" class="cards"></div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="section section-contact">
      <div class="inner narrow">
        <h2>Contact Us</h2>
        <form id="contactForm" class="card form-card">
          <div class="row">
            <input id="cname" placeholder="Your name" required/>
            <input id="cemail" type="email" placeholder="Email" required/>
          </div>
          <input id="csubject" placeholder="Subject" required/>
          <textarea id="cmessage" placeholder="Message" required></textarea>
          <button type="submit" class="primary">Send Message</button>
          <div id="contactMsg" class="muted small" style="margin-top:.6rem;"></div>
        </form>
      </div>
    </section>

    <!-- DASHBOARD -->
    <section id="dashboard" class="section section-dashboard">
      <div class="inner narrow">
        <div class="db-head">
          <h2>Dashboard</h2>
          <div>
            <button id="refreshDash" class="small">Refresh</button>
            <button id="btnLogout" class="small ghost">Logout</button>
          </div>
        </div>

        <div class="cards db-cards">
          <div class="db-card">
            <div class="db-title">User</div>
            <div id="dashUser" class="db-value">Guest</div>
          </div>
          <div class="db-card">
            <div class="db-title">Promotions</div>
            <div id="dashPromoCount" class="db-value">0</div>
          </div>
          <div class="db-card">
            <div class="db-title">Festivals (total)</div>
            <div id="dashFestCount" class="db-value">0</div>
          </div>
        </div>

        <div style="margin-top:18px">
          <h3>Recent Promotions</h3>
          <div id="dashPromoList" class="list"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <small>Â© 2025 MyFest & Promo â€” Demo project â€¢ Built for BCA final year</small>
  </footer>

  <script>/* -------------------------
   Simple SPA behavior
   ------------------------- */
const navBtns = document.querySelectorAll(".nav-btn");
const sections = document.querySelectorAll(".section");
const openAuthBtn = document.getElementById("openAuth");
const authOverlay = document.getElementById("authOverlay");
const closeAuth = document.getElementById("closeAuth");
const authTitle = document.getElementById("authTitle");
const authAction = document.getElementById("authAction");
const authToggle = document.getElementById("authToggle");
const authUser = document.getElementById("authUser");
const authPass = document.getElementById("authPass");
const skipAuth = document.getElementById("skipAuth");
const displayUser = document.getElementById("displayUser");
const btnLogout = document.getElementById("btnLogout");

function showSection(id){
  sections.forEach(s => s.classList.remove("active"));
  const el = document.getElementById(id);
  if(el) el.classList.add("active");
  window.scrollTo({top:0,behavior:"smooth"});
}
navBtns.forEach(b => b.addEventListener("click", ()=> showSection(b.dataset.target)));
document.querySelectorAll("[data-target]").forEach(bt => {
  bt.addEventListener("click", ()=> showSection(bt.dataset.target));
});

/* -------------------------
   Auth (localStorage)
   ------------------------- */
let isLoginMode = true;

function setAuthMode(login){
  isLoginMode = login;
  authTitle.textContent = login ? "Login" : "Sign Up";
  authAction.textContent = login ? "Login" : "Create Account";
  authToggle.textContent = login ? "Sign Up" : "Login";
  authUser.value = "";
  authPass.value = "";
}
openAuthBtn.addEventListener("click", ()=> {
  authOverlay.classList.remove("hidden");
  setAuthMode(true);
});
closeAuth.addEventListener("click", ()=> authOverlay.classList.add("hidden"));
authToggle.addEventListener("click", ()=> setAuthMode(!isLoginMode));
skipAuth.addEventListener("click", ()=> {
  authOverlay.classList.add("hidden");
  displayUser.textContent = "Guest";
  localStorage.removeItem("loggedIn");
});
authAction.addEventListener("click", ()=> {
  const u = authUser.value.trim();
  const p = authPass.value.trim();
  if(!u || !p){ alert("Enter username & password"); return; }

  if(isLoginMode){
    const saved = JSON.parse(localStorage.getItem("mf_user") || "null");
    if(saved && saved.username === u && saved.password === p){
      localStorage.setItem("mf_logged","1");
      displayUser.textContent = u;
      authOverlay.classList.add("hidden");
      refreshDashboard();
      alert("Welcome back, " + u + "!");
    } else {
      alert("Invalid credentials. If new user, please Sign Up.");
    }
  } else {
    const obj = { username:u, password:p };
    localStorage.setItem("mf_user", JSON.stringify(obj));
    alert("Account created. Please login.");
    setAuthMode(true);
  }
});

function checkAutoLogin(){
  if(localStorage.getItem("mf_logged") === "1"){
    const u = JSON.parse(localStorage.getItem("mf_user") || "null");
    if(u) displayUser.textContent = u.username;
  } else {
    displayUser.textContent = "Guest";
  }
}
checkAutoLogin();

btnLogout && btnLogout.addEventListener("click", ()=> {
  localStorage.removeItem("mf_logged");
  displayUser.textContent = "Guest";
  alert("Logged out");
  showSection("home");
});

/* -------------------------
   Calendar: month view + festivals
   ------------------------- */
const calGrid = document.getElementById("calGrid");
const monthYear = document.getElementById("monthYear");
const calPrev = document.getElementById("calPrev");
const calNext = document.getElementById("calNext");
const addFestForm = document.getElementById("addFestForm");
const festName = document.getElementById("festName");
const festDate = document.getElementById("festDate");
const selDate = document.getElementById("selDate");
const selFestivals = document.getElementById("selFestivals");

let viewDate = new Date();
let festivals = JSON.parse(localStorage.getItem("mf_festivals") || "null");
if(!festivals){
  festivals = [
    {name:"Makar Sankranti", date:"2025-01-14"},
    {name:"Holi", date:"2025-03-14"},
    {name:"Raksha Bandhan", date:"2025-08-09"},
    {name:"Ganesh Chaturthi", date:"2025-08-29"},
    {name:"Navratri Start", date:"2025-09-29"},
    {name:"Dussehra", date:"2025-10-02"},
    {name:"Diwali", date:"2025-10-20"},
    {name:"Christmas", date:"2025-12-25"}
  ];
  localStorage.setItem("mf_festivals", JSON.stringify(festivals));
}

function monthLabel(d){
  return d.toLocaleString(undefined,{month:"long", year:"numeric"});
}

function getMonthMatrix(d){
  const y = d.getFullYear(), m = d.getMonth();
  const first = new Date(y,m,1);
  const startDay = first.getDay();
  const daysInMonth = new Date(y,m+1,0).getDate();
  const cells = [];
  for(let i=0;i<startDay;i++) cells.push(null);
  for(let day=1; day<=daysInMonth; day++) cells.push(new Date(y,m,day));
  while(cells.length % 7 !== 0) cells.push(null);
  return cells;
}

function renderCalendar(){
  monthYear.textContent = monthLabel(viewDate);
  calGrid.innerHTML = "";
  const cells = getMonthMatrix(viewDate);
  const todayISO = new Date().toISOString().slice(0,10);
  cells.forEach(dt => {
    const div = document.createElement("div");
    div.className = "cal-cell";
    if(!dt){ div.classList.add("inactive"); calGrid.appendChild(div); return; }
    const iso = dt.toISOString().slice(0,10);
    const dnum = document.createElement("div"); dnum.className="dateNum"; dnum.textContent = dt.getDate();
    div.appendChild(dnum);

    const match = festivals.filter(f=>f.date===iso);
    if(match.length){
      const dot = document.createElement("div"); dot.className="dot"; div.appendChild(dot);
      match.forEach(m => {
        const b = document.createElement("span"); b.className="badge"; b.textContent = m.name;
        div.appendChild(b);
      });
    }
    if(iso === todayISO) div.style.outline = "2px solid rgba(106,139,255,0.6)";

    div.addEventListener("click", ()=> selectDate(iso));
    calGrid.appendChild(div);
  });
}
function selectDate(iso){
  selDate.textContent = "Selected: " + new Date(iso).toDateString();
  selFestivals.innerHTML = "";
  const items = festivals.filter(f=>f.date===iso);
  if(items.length===0){
    selFestivals.innerHTML = "<li>No festivals on this date.</li>";
  } else {
    items.forEach(it => {
      const li = document.createElement("li"); li.textContent = it.name; selFestivals.appendChild(li);
    });
  }
}
calPrev.addEventListener("click", ()=> { viewDate.setMonth(viewDate.getMonth()-1); renderCalendar(); });
calNext.addEventListener("click", ()=> { viewDate.setMonth(viewDate.getMonth()+1); renderCalendar(); });

addFestForm.addEventListener("submit", (e)=>{
  e.preventDefault();
  const name = festName.value.trim();
  const date = festDate.value;
  if(!name || !date) return;
  festivals.push({name, date});
  localStorage.setItem("mf_festivals", JSON.stringify(festivals));
  renderCalendar();
  festName.value = ""; festDate.value = "";
  if(document.getElementById("selDate") && selDate.textContent.includes(date)) selectDate(date);
});
renderCalendar();

/* -------------------------
   Promotions (CRUD in localStorage)
   ------------------------- */
const promoForm = document.getElementById("promoForm");
const promoTitle = document.getElementById("promoTitle");
const promoStart = document.getElementById("promoStart");
const promoEnd = document.getElementById("promoEnd");
const promoOff = document.getElementById("promoOff");
const promoCode = document.getElementById("promoCode");
const promoDesc = document.getElementById("promoDesc");
const promoList = document.getElementById("promoList");
const genCoupon = document.getElementById("genCoupon");
const exportPromo = document.getElementById("exportPromo");

let promotions = JSON.parse(localStorage.getItem("mf_promotions") || "[]");

function randCode(len=8){
  const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  let out = ""; for(let i=0;i<len;i++) out += chars[Math.floor(Math.random()*chars.length)];
  return out;
}
genCoupon.addEventListener("click", ()=> promoCode.value = randCode());

function renderPromos(){
  promoList.innerHTML = "";
  if(promotions.length===0) promoList.innerHTML = "<p class='muted'>No promotions yet.</p>";
  promotions.slice().reverse().forEach(p => {
    const card = document.createElement("div");
    card.className = "promo-card card";
    // gradient based on id hash
    const hue = (p.code || "").length * 37 % 360;
    card.style.background = `linear-gradient(135deg,hsl(${hue} 80% 55%), hsl(${(hue+35)%360} 70% 45%))`;
    card.innerHTML = `
      <div class="prom-title">${escapeHtml(p.title)}</div>
      <div class="prom-meta">${formatDate(p.start)} â†’ ${formatDate(p.end)} â€¢ ${p.off}%</div>
      <div class="promo-code">Code: <strong>${escapeHtml(p.code)}</strong></div>
      <div class="prom-actions">
        <button class="small ghost copyBtn">Copy</button>
        <button class="small ghost editBtn">Edit</button>
        <button class="small ghost delBtn">Delete</button>
      </div>
      <div style="margin-top:8px;color:rgba(255,255,255,0.95)">${escapeHtml(p.desc||"")}</div>
    `;
    // events
    card.querySelector(".copyBtn").addEventListener("click", ()=> {
      navigator.clipboard?.writeText(p.code).then(()=> alert("Copied: " + p.code)).catch(()=> alert("Copy failed"));
    });
    card.querySelector(".delBtn").addEventListener("click", ()=> {
      if(confirm("Delete this promotion?")){
        promotions = promotions.filter(x=> x.id !== p.id);
        savePromos();
        renderPromos();
        refreshDashboard();
      }
    });
    card.querySelector(".editBtn").addEventListener("click", ()=> {
      // load into form
      promoTitle.value = p.title; promoStart.value = p.start; promoEnd.value = p.end;
      promoOff.value = p.off; promoCode.value = p.code; promoDesc.value = p.desc || "";
      promoForm.dataset.editing = p.id;
      promoForm.querySelector(".primary").textContent = "Update";
      showSection("promotion");
      window.scrollTo({top:0,behavior:"smooth"});
    });

    promoList.appendChild(card);
  });
}
function savePromos(){ localStorage.setItem("mf_promotions", JSON.stringify(promotions)); }
function formatDate(s){ if(!s) return "â€”"; const d = new Date(s); return d.toLocaleDateString(); }
function escapeHtml(s){ return String(s||"").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

promoForm.addEventListener("submit", (e)=>{
  e.preventDefault();
  const data = {
    id: promoForm.dataset.editing || cryptoRandomUUID(),
    title: promoTitle.value.trim(),
    start: promoStart.value,
    end: promoEnd.value,
    off: Number(promoOff.value || 0),
    code: promoCode.value.trim() || randCode(),
    desc: promoDesc.value.trim()
  };
  if(new Date(data.end) < new Date(data.start)){ alert("End date must be after start date"); return; }
  const idx = promotions.findIndex(x => x.id === data.id);
  if(idx>=0) promotions[idx] = data; else promotions.push(data);
  savePromos();
  promoForm.reset();
  delete promoForm.dataset.editing;
  promoForm.querySelector(".primary").textContent = "Save Promotion";
  renderPromos();
  refreshDashboard();
});

document.getElementById("clearPromo").addEventListener("click", ()=> {
  promoForm.reset(); delete promoForm.dataset.editing; promoForm.querySelector(".primary").textContent = "Save Promotion";
});

exportPromo.addEventListener("click", ()=> {
  const rows = promotions.map(p => [p.title,p.start,p.end,p.off,p.code,(p.desc||"")]);
  const csv = ["Title,Start,End,Off,Code,Desc"].concat(rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(","))).join("\n");
  const blob = new Blob([csv], {type:"text/csv"});
  const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "promotions.csv"; a.click();
  URL.revokeObjectURL(a.href);
});

function refreshPromosFromStorage(){ promotions = JSON.parse(localStorage.getItem("mf_promotions") || "[]"); renderPromos(); }
refreshPromosFromStorage();

/* -------------------------
   Contact form (demo)
   ------------------------- */
const contactForm = document.getElementById("contactForm");
const contactMsg = document.getElementById("contactMsg");
contactForm && contactForm.addEventListener("submit",(e)=>{
  e.preventDefault();
  const msg = {
    id: cryptoRandomUUID(),
    name: document.getElementById("cname").value.trim(),
    email: document.getElementById("cemail").value.trim(),
    subject: document.getElementById("csubject").value.trim(),
    message: document.getElementById("cmessage").value.trim(),
    ts: new Date().toISOString()
  };
  // store demo
  const arr = JSON.parse(localStorage.getItem("mf_contacts") || "[]");
  arr.push(msg); localStorage.setItem("mf_contacts", JSON.stringify(arr));
  contactMsg.textContent = "âœ… Message sent (demo). We will reply soon.";
  contactForm.reset();
  setTimeout(()=> contactMsg.textContent = "", 4000);
});

/* -------------------------
   Dashboard helpers
   ------------------------- */
const dashUser = document.getElementById("dashUser");
const dashPromoCount = document.getElementById("dashPromoCount");
const dashFestCount = document.getElementById("dashFestCount");
const dashPromoList = document.getElementById("dashPromoList");
const refreshDash = document.getElementById("refreshDash");

function refreshDashboard(){
  const u = JSON.parse(localStorage.getItem("mf_user") || "null");
  if(localStorage.getItem("mf_logged") === "1" && u) {
    dashUser.textContent = u.username;
    displayUser.textContent = u.username;
  } else {
    dashUser.textContent = "Guest";
    displayUser.textContent = "Guest";
  }
  const promos = JSON.parse(localStorage.getItem("mf_promotions") || "[]");
  dashPromoCount.textContent = promos.length;
  dashFestCount.textContent = (JSON.parse(localStorage.getItem("mf_festivals") || "[]")).length || 0;

  dashPromoList.innerHTML = "";
  promos.slice().reverse().slice(0,5).forEach(p => {
    const div = document.createElement("div");
    div.className = "list-item";
    div.textContent = `${p.title} â€¢ ${formatDate(p.start)} â†’ ${formatDate(p.end)} â€¢ ${p.code}`;
    dashPromoList.appendChild(div);
  });
}
refreshDash.addEventListener("click", refreshDashboard);
refreshDashboard();

/* -------------------------
   Utilities & small polyfills
   ------------------------- */
function cryptoRandomUUID(){
  if(window.crypto && crypto.randomUUID) return crypto.randomUUID();
  // fallback
  return 'id-' + Math.random().toString(36).slice(2,9);
}
function escapeHtml(s){ return String(s||"").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* init */
renderPromos();
refreshDashboard();
checkAutoLogin();
</script>
</body>
</html>
